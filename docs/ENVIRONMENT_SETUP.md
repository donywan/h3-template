# ç¯å¢ƒé…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä¸ºä¸åŒç¯å¢ƒé…ç½®H3æœåŠ¡å™¨ã€‚

## ğŸŒ æ”¯æŒçš„ç¯å¢ƒ

é¡¹ç›®æ”¯æŒä¸‰ç§ç¯å¢ƒï¼Œæ¯ç§ç¯å¢ƒéƒ½æœ‰ç‹¬ç«‹çš„é…ç½®å’Œæ•°æ®åº“ï¼š

| ç¯å¢ƒ | ç«¯å£ | æ•°æ®åº“ç«¯å£ | Redisç«¯å£ | æè¿° |
|------|------|------------|-----------|------|
| **å¼€å‘ç¯å¢ƒ** | 3000 | 5432 | 6379 | æœ¬åœ°å¼€å‘ï¼Œè¯¦ç»†æ—¥å¿—ï¼Œå®½æ¾å®‰å…¨è®¾ç½® |
| **æµ‹è¯•ç¯å¢ƒ** | 3001 | 5433 | 6380 | è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç‹¬ç«‹æ•°æ®åº“ï¼Œé™é»˜æ—¥å¿— |
| **ç”Ÿäº§ç¯å¢ƒ** | 3000 | 5432 | 6379 | ç”Ÿäº§éƒ¨ç½²ï¼Œä¸¥æ ¼å®‰å…¨è®¾ç½®ï¼ŒSSLæ”¯æŒ |

## ğŸ“ é…ç½®æ–‡ä»¶

```
.env.development    # å¼€å‘ç¯å¢ƒé…ç½®
.env.test          # æµ‹è¯•ç¯å¢ƒé…ç½®
.env.production    # ç”Ÿäº§ç¯å¢ƒé…ç½®
.env.example       # é…ç½®æ¨¡æ¿
```

## ğŸ”§ ç¯å¢ƒå˜é‡è¯´æ˜

### æ ¸å¿ƒé…ç½®

| å˜é‡å | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ | è¯´æ˜ |
|--------|----------|----------|----------|------|
| `NODE_ENV` | development | test | production | è¿è¡Œç¯å¢ƒ |
| `PORT` | 3000 | 3001 | 3000 | æœåŠ¡ç«¯å£ |
| `HOST` | 0.0.0.0 | 127.0.0.1 | 0.0.0.0 | ç»‘å®šåœ°å€ |

### æ•°æ®åº“é…ç½®

| å˜é‡å | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|----------|
| `DB_HOST` | localhost | localhost | localhost |
| `DB_PORT` | 5432 | 5433 | 5432 |
| `DB_NAME` | h3_dev_db | h3_test_db | h3_prod_db |
| `DB_USER` | postgres | test_user | postgres |
| `DB_PASSWORD` | dev_password | test_password | secure_production_password |
| `DB_SSL` | false | false | true |
| `DB_MAX_CONNECTIONS` | 5 | 3 | 20 |

### å®‰å…¨é…ç½®

| å˜é‡å | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|----------|
| `JWT_SECRET` | dev-super-secret... | test-jwt-secret... | CHANGE_THIS_IN_PRODUCTION |
| `JWT_EXPIRES_IN` | 7d | 1h | 24h |
| `CORS_ORIGIN` | * | localhost:3000,3001 | https://yourdomain.com |
| `RATE_LIMIT_MAX` | 1000 | 1000 | 100 |

### æ—¥å¿—é…ç½®

| å˜é‡å | å¼€å‘ç¯å¢ƒ | æµ‹è¯•ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|----------|
| `LOG_LEVEL` | debug | error | info |
| `LOG_FORMAT` | pretty | json | json |

## ğŸš€ å¯åŠ¨ä¸åŒç¯å¢ƒ

### æœ¬åœ°å¯åŠ¨

```bash
# å¼€å‘ç¯å¢ƒ
bun run dev
# æˆ–
NODE_ENV=development bun run src/index.ts

# æµ‹è¯•ç¯å¢ƒ
bun run dev:test
# æˆ–
NODE_ENV=test bun run src/index.ts

# ç”Ÿäº§ç¯å¢ƒ
bun run start
# æˆ–
NODE_ENV=production bun run src/index.ts
```

### Dockerå¯åŠ¨

```bash
# å¼€å‘ç¯å¢ƒ
bun run docker:up:dev

# æµ‹è¯•ç¯å¢ƒ
bun run docker:up:test

# ç”Ÿäº§ç¯å¢ƒ
bun run docker:up
```

## ğŸ—„ï¸ æ•°æ®åº“ç®¡ç†

### ä¸åŒç¯å¢ƒçš„æ•°æ®åº“æ“ä½œ

```bash
# å¼€å‘ç¯å¢ƒ
bun run db:migrate:dev
bun run db:studio:dev
bun run db:push:dev

# æµ‹è¯•ç¯å¢ƒ
bun run db:migrate:test
bun run db:studio:test
bun run db:push:test

# ç”Ÿäº§ç¯å¢ƒ
bun run db:migrate:prod
bun run db:studio:prod
bun run db:push:prod
```

### æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

æ¯ä¸ªç¯å¢ƒéƒ½æœ‰ç‹¬ç«‹çš„åˆå§‹åŒ–è„šæœ¬ï¼š

- `docker/init-dev.sql` - å¼€å‘ç¯å¢ƒï¼ŒåŒ…å«ä¸°å¯Œçš„æµ‹è¯•æ•°æ®
- `docker/init-test.sql` - æµ‹è¯•ç¯å¢ƒï¼ŒåŒ…å«æµ‹è¯•ä¸“ç”¨æ•°æ®å’Œå‡½æ•°
- `docker/init.sql` - ç”Ÿäº§ç¯å¢ƒï¼ŒåªåŒ…å«åŸºç¡€ç»“æ„å’Œæœ€å°‘æ•°æ®

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ
- âœ… å…è®¸æ‰€æœ‰CORSæ¥æº
- âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—
- âœ… å®½æ¾çš„é€Ÿç‡é™åˆ¶
- âœ… å¯ç”¨è°ƒè¯•è·¯ç”±

### æµ‹è¯•ç¯å¢ƒ
- âš ï¸ é™åˆ¶CORSæ¥æº
- âš ï¸ é™é»˜æ—¥å¿—æ¨¡å¼
- âš ï¸ ç‹¬ç«‹çš„æ•°æ®åº“å’Œç«¯å£
- âš ï¸ çŸ­æœŸJWTè¿‡æœŸæ—¶é—´

### ç”Ÿäº§ç¯å¢ƒ
- ğŸ”’ ä¸¥æ ¼çš„CORSç­–ç•¥
- ğŸ”’ å¯ç”¨SSL/TLS
- ğŸ”’ å¼ºåˆ¶HTTPS
- ğŸ”’ ä¸¥æ ¼çš„é€Ÿç‡é™åˆ¶
- ğŸ”’ ç¦ç”¨è°ƒè¯•åŠŸèƒ½
- ğŸ”’ å¼ºå¯†ç è¦æ±‚

## ğŸ“Š å¥åº·æ£€æŸ¥

æ¯ä¸ªç¯å¢ƒéƒ½æä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼š

```bash
# å¼€å‘ç¯å¢ƒ
curl http://localhost:3000/health

# æµ‹è¯•ç¯å¢ƒ
curl http://127.0.0.1:3001/health

# ç”Ÿäº§ç¯å¢ƒ
curl http://localhost:3000/health
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "status": "ok",
  "environment": "development",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "database": {
    "host": "localhost",
    "port": 5432,
    "database": "h3_dev_db"
  },
  "version": "1.0.0"
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tulpn | grep :3000
   
   # ä¿®æ”¹ç«¯å£
   export PORT=3001
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“é…ç½®
   echo $DATABASE_URL
   
   # æµ‹è¯•è¿æ¥
   psql $DATABASE_URL
   ```

3. **ç¯å¢ƒå˜é‡æœªåŠ è½½**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶
   cat .env.development
   
   # æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒ
   export NODE_ENV=development
   ```

### è°ƒè¯•æŠ€å·§

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
NODE_ENV=development bun run src/index.ts

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
printenv | grep -E "(NODE_ENV|DB_|PORT)"

# æµ‹è¯•æ•°æ®åº“è¿æ¥
bun run db:studio:dev
```

## ğŸ“ æœ€ä½³å®è·µ

1. **æ°¸è¿œä¸è¦**åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­æäº¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ `.env` æ–‡ä»¶
2. **ä½¿ç”¨**ç¯å¢ƒç‰¹å®šçš„é…ç½®æ–‡ä»¶è€Œä¸æ˜¯ä¿®æ”¹é€šç”¨é…ç½®
3. **å®šæœŸ**æ›´æ–°ç”Ÿäº§ç¯å¢ƒçš„å¯†é’¥å’Œå¯†ç 
4. **æµ‹è¯•**æ¯ä¸ªç¯å¢ƒçš„é…ç½®æ˜¯å¦æ­£ç¡®å·¥ä½œ
5. **ç›‘æ§**ç”Ÿäº§ç¯å¢ƒçš„å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
